# 库存遗留问题

因为 乐观锁的原因，假如我们有2000个人抢500个商品，假如2000个人同时读这个kcKey，然后kcKey的版本是1.0，然后用户一第一个抢到的然后kcKey变成1.1，这时候其他的人想要写的时候发现版本号变了，变成了1.1，所以他们只能放弃写入但是同时会有1999个商品没有被成功购买。

### 1. 所以我们采用LUA脚本

LUA脚本的特性就是，将复杂的或者多步的redis操作写成一个脚本，一次性提交给redis执行，完全变成一个单线程。具有一定的原子性，不会被其他的命令插队，可以完成redis事务性操作。

![image-20210723163038374](D:\Tutorial\Redis\image\image-20210723163038374.png)