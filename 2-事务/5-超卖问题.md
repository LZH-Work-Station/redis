# 超卖问题的解决方案

## 1. 使用watch key方法

```java
jedis.watch(kcKey);    // kcKey是我们的库存，他的value是 还剩多少货物

// --------判断是否卖完了，如果卖完了就close jedis，没卖完就开始事务-----------

// 秒杀过程，创建事务
Transaction multi = jedis.multi();

// 组队操作
multi.decr(kcKey);
multi.sadd(userKey, uid);    // 将秒杀成功的用户加紧userKey里面，记录userId

// 执行，如果返回值为空或者size=0代表 这个kcKey和userKey被别人动过了，需要重新申请
List<Object> results = multi.exec();
if(results==null||results.size()==0){
    System.out.println("秒杀失败");
    jedis.close();
    return false;
}
```

